<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Visualizing Travel Times with Multidimensional Scaling</title><meta name="description" content="What is Multidimensional Scaling? How can it help us to approximate arbitrary distances in 2 dimensions? Read this blog post to find out."><meta property="og:locale" content="en_US"><meta property="og:type" content="website"><meta property="og:title" content="Visualizing Travel Times with Multidimensional Scaling"><meta property="og:description" content="What is Multidimensional Scaling? How can it help us to approximate arbitrary distances in 2 dimensions? Read this blog post to find out."><meta property="og:url" content="https://theblog.github.io"><meta property="og:site_name" content="The Blog"><meta name="twitter:card" content="summary"><meta name="twitter:description" content="What is Multidimensional Scaling? How can it help us to approximate arbitrary distances in 2 dimensions? Read this blog post to find out."><meta name="twitter:title" content="Visualizing Travel Times with Multidimensional Scaling"><link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"><link rel="manifest" href="/favicons/manifest.json"><meta name="msapplication-config" content="/favicons/browserconfig.xml"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"><link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.1.6/css/ion.rangeSlider.min.css"><link rel="stylesheet" href="/css/lib/ion.rangeSlider/css/ion.rangeSlider.skinFlat.css"><link rel="stylesheet" href="/css/lib/highlight.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/post-util.css"><link rel="stylesheet" href="/css/nav.css"><link rel="stylesheet" href="https://unpkg.com/applause-button/dist/applause-button.css"><link rel="stylesheet" href="/css/posts/visualizing-travel-times-with-multidimensional-scaling.css"><script type="text/javascript">var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="https://ec2-01.batzner.io/analytics/matomo/";_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.defer=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}();</script></head><body><img src="https://ec2-01.batzner.io/ln/mtmslm.php?idsite=1&amp;rec=1&amp;action_name=Visualizing+Travel+Times+with+Multidimensional+Scaling" style="border:0; margin:0; position:absolute; opacity:0; max-width:1px; max-height:1px" alt><nav role="navigation" id="navigation" class="navbar navbar-default"><div class="navbar-header"><button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><div class="navbar-brand"><a href="https://theblog.github.io"><div id="logo-title"><img src="/images/logo.png"></div><div id="logo-subtitle">A Random Walk Through Computer Science</div></a></div></div><div id="navbarCollapse" class="collapse navbar-collapse"><h5><a href="https://theblog.github.io">Posts</a></h5><div class="nav navbar-nav"><h5 class="navigation-year">2019</h5><ul><li><a href="/post/convolution-in-autoregressive-neural-networks/">Convolutions in Autoregressive Neural Networks</a></li></ul><h5 class="navigation-year">2017</h5><ul><li><a href="/post/gini-coefficient-intuitive-explanation/">Intuitive Explanation of the Gini Coefficient</a></li><li><a href="/post/swift-icloud-key-value-store/">iCloud Key-Value Storage in Swift 3</a></li><li><a href="/post/jekyll-github-pages-gulp-babel-directory-structure/">Directory Structure for Jekyll / GitHub Pages with Gulp and Babel</a></li><li><a href="/post/character-language-model-lstm-tensorflow/">An Interactive Character-Level Language Model</a></li></ul><h5 class="navigation-year">2016</h5><ul><li><a class="active" href="/post/visualizing-travel-times-with-multidimensional-scaling/">Visualizing Travel Times with Multidimensional Scaling</a></li></ul><h5 class="navigation-year">2015</h5><ul><li><a href="/post/some-facts-i-did-not-know-about-java/">Some facts I did not know about Java</a></li></ul></div><h5><a href="/about/">About</a></h5></div></nav><section class="wrapper"><div id="content" class="container-fluid"><div class="row"><div class="col-lg-12"><div class="panel panel-default panel-post"><div class="panel-heading"><div class="headings"><h1>Visualizing Travel Times with Multidimensional Scaling</h1><h5><span><i class="fa fa-calendar-o"></i> 13 January 2016</span></h5></div></div><div class="panel-body post-body"><div>Which map is correct?<div class="gmaps clearfix"><div class="gmap-container-stub"><img src="/images/posts/visualizing-travel-times-with-multidimensional-scaling/map-correct.jpg" alt="distances"></div><div class="gmap-container-stub"><img src="/images/posts/visualizing-travel-times-with-multidimensional-scaling/map-mds.jpg" alt="durations"></div></div>In a geography exam, the correct answer would be the left / upper one. It displays the actual positions of four cities in the US. But that does not make the other map incorrect. It just displays other data. Specifically, it approximates the travel times between the four cities. This means that the closer two cities are on the right map the faster you can travel between them with public transport. We can calculate such maps using Multidimensional Scaling. What is Multidimensional Scaling? How can it help us to approximate travel times? And what is the relationship between the left map with the actual positions and the right map? We are about to find out.<h3>Task</h3>Take a look at the following table.<table class="distance-table"><tr><th></th><th>San Francisco</th><th>Sacramento</th><th>Los Angeles</th><th>Las Vegas</th></tr><tr><th>San Francisco</th><td style="background-color: rgba(255, 200, 200, 0);">-</td><td style="background-color: rgba(255, 200, 200, 0);">121 km</td><td style="background-color: rgba(255, 200, 200, 0.8);">559 km</td><td style="background-color: rgb(255, 200, 200);">670 km</td></tr><tr><th>Sacramento</th><td style="background-color: rgba(255, 200, 200, 0);">121 km</td><td style="background-color: rgba(255, 200, 200, 0);">-</td><td style="background-color: rgba(255, 200, 200, 0.839216);">582 km</td><td style="background-color: rgba(255, 200, 200, 0.913725);">622 km</td></tr><tr><th>Los Angeles</th><td style="background-color: rgba(255, 200, 200, 0.8);">559 km</td><td style="background-color: rgba(255, 200, 200, 0.839216);">582 km</td><td style="background-color: rgba(255, 200, 200, 0);">-</td><td style="background-color: rgba(255, 200, 200, 0.439216);">361 km</td></tr><tr><th>Las Vegas</th><td style="background-color: rgb(255, 200, 200);">670 km</td><td style="background-color: rgba(255, 200, 200, 0.913725);">622 km</td><td style="background-color: rgba(255, 200, 200, 0.439216);">361 km</td><td style="background-color: rgba(255, 200, 200, 0);">-</td></tr></table>It shows the linear distances between the cities in the two maps above. A strong cell color indicates a large distance. Now take a look at the second table. Each cell displays the time needed to travel by public transportation from one city to another.<table class="duration-table"><tr><th></th><th>San Francisco</th><th>Sacramento</th><th>Los Angeles</th><th>Las Vegas</th></tr><tr><th>San Francisco</th><td style="background-color: rgba(255, 200, 200, 0);">-</td><td style="background-color: rgba(255, 200, 200, 0);">1 h 50 min</td><td style="background-color: rgba(255, 200, 200, 0.329412);">7 h 18 min</td><td style="background-color: rgba(255, 200, 200, 0.921569);">17 h 7 min</td></tr><tr><th>Sacramento</th><td style="background-color: rgba(255, 200, 200, 0.0196078);">2 h 12 min</td><td style="background-color: rgba(255, 200, 200, 0);">-</td><td style="background-color: rgba(255, 200, 200, 0.580392);">11 h 30 min</td><td style="background-color: rgba(255, 200, 200, 0.905882);">16 h 51 min</td></tr><tr><th>Los Angeles</th><td style="background-color: rgba(255, 200, 200, 0.34902);">7 h 40 min</td><td style="background-color: rgba(255, 200, 200, 0.490196);">10 h 0 min</td><td style="background-color: rgba(255, 200, 200, 0);">-</td><td style="background-color: rgba(255, 200, 200, 0.262745);">6 h 14 min</td></tr><tr><th>Las Vegas</th><td style="background-color: rgba(255, 200, 200, 0.776471);">14 h 45 min</td><td style="background-color: rgb(255, 200, 200);">18 h 28 min</td><td style="background-color: rgba(255, 200, 200, 0.254902);">6 h 5 min</td><td style="background-color: rgba(255, 200, 200, 0);">-</td></tr></table><p>The similarity of both color maps shows that, generally, the travel time is proportional to the distance between two cities. However, there are small irregularities: the distance between San Francisco and Los Angeles is roughly the same as the distance between San Francisco and Las Vegas. But the time needed to travel to Las Vegas is more than twice the time needed to travel to Los Angeles from San Francisco. So either San Francisco and Los Angeles are exceptionally well-connected or San Francisco and Las Vegas exceptionally badly.</p><p>Overall, we see that the distance between two cities does not necessarily correlate with their proximity by public transport. So, if we try to visualize, how well cities are connected to each other, their actual geolocation may not be representative. A better solution is to take the table of travel times and calculate a set of coordinates so that the distance between those coordinates resembles the travel time as best as possible. I will describe the required steps in detail below. But first, you can take a look at the result:</p><h3>Result</h3>I created a small tool to visualize the results of this post. In the upper left corner of the map below, you will find a search box. Select four to ten cities, which are reachable by public transportation. In the left / upper map, you will see their actual locations. The right / lower map will display the cities in a way that well-connected​ cities are closer to each other.<div class="gmaps clearfix"><input id="pac-input" class="gmaps-controls" type="text" placeholder="Search Box"><div class="gmap-container"><div class="custom-gmap" id="city-map"></div></div><div class="gmap-container"><div class="custom-gmap" id="coordinate-map"></div></div></div><div class="alert alert-danger" id="post-error"></div>If you want to understand, why certain cities are closer and others are not, you can take a look at the distance table and the table of travel durations below. Two cities being closer on the right map than on the left map indicates a good ratio between travel time and distance. If the cities' positions on the right map still seem arbitrary, please take a look at the "Solution" part.<br><br><p>Distances:</p><table id="distance-table" class="distance-table"></table><p>Travel durations by public transport (next Monday, 12 pm):</p><table id="duration-table" class="duration-table"></table><h3>Solution</h3><strong>Given:</strong> The cities' geolocations and a matrix of travel times between their central stations.<h5>Multidimensional Scaling</h5><p>We start with the matrix of travel times. Given a matrix of distances / similarities between points, it is possible to calculate coordinates for each point that depict the similarities between the points when drawn onto a coordinate system. This process is called <a href="https://en.wikipedia.org/wiki/Multidimensional_scaling" target="_blank">Multidimensional Scaling</a>. However, the distance between two points cannot always be equal to the value given by the matrix. Imagine a matrix with small entries for A-B and B-C but a large entry for A-C. How can you draw A,B and C into a coordinate system without breaking the constraints given by the matrix?</p><p>Generally, we draw the points into Euclidean space, the usual two-dimensional space of a coordinate system (see <a href="#notes">notes</a> for further details on why we use Euclidean space). But if the distances given by the matrix of travel times do not strictly follow Euclidean rules, like in the example above, it is impossible to draw points in a coordinate system so that their distances match the entries of the matrix. Instead, we need to draw points that <strong>approximate</strong> the given travel times.</p><p>Ben Frederickson describes in his <a href="http://www.benfrederickson.com/multidimensional-scaling/" target="_blank">blog post</a>, how you can use the Singular Value Decomposition of the squared distance matrix to obtain a set of points with optimal coordinates. The coordinates will be optimal in a way that the sum of all squared errors is minimal. The error of a pair of points is defined as the difference of their distance given by the matrix and the distance in the obtained set of points. Given a matrix \(A\) and the set \(P\) with \(N\) points, the overall error \(e\) is defined as $$e = \sum _{i=1}^{N}{~} \sum _{j=1, j\ne i}^{N}{~}(a_{i,j}~-~dist(p_i,~p_j))^2$$ with \(dist(p_i, p_j)\) being the Euclidean distance between a pair of points. This error is minimized when using Multidimensional Scaling. As said above, it will be zero, if the given matrix entries follow Euclidean geometry rules. We, however, deal with travel times, which are not strictly proportional to the distances between cities, since trains do not always go the same speed and not every city is directly connected to all others. So we obtain a set of points, whose distances approximate the given travel times.</p><h5>Transforming the points to match the geolocations</h5><p>The points obtained by Multidimensional Scaling will not match the geolocations of the cities. This is due to two facts:</p><ul><li>The travel times are given in seconds, while the distances between cities are measured in meters. As these are two completely different scales, the points' coordinates first have to be scaled to geo-coordinates.</li><li>Rotating or moving the set of points does not change the distances between its points. So, even if we scale the points to geo-coordinates, they may be upside down or at a completely different place on the earth. But since the set's inner distances do not change, it is still the optimal solution for approximating the matrix of travel times.</li></ul>In short, we have to <strong>rotate, scale</strong> and <strong>move</strong> the set of points in order to get meaningful results.<p></p><p>First, we will rotate and scale the points so that they match the actual geo-coordinates as closely as possible. Note that their relative distances will be preserved, so the resulting set of points is still the best approximation for the travel times. We will move the points afterwards, so before rotating and scaling them, we center both the set of points and the set of geo-coordinates. Thus, their centroids will be \((0,0)\). Since we have 2-dimensional points \(p = (p_0, p_1)\), we can rotate and scale them by applying a 2x2 matrix \(R\) to each point. Given a Nx2 matrix \(P\) containing all points, a Nx2 matrix \(G\) containing all geo-coordinates and the rotation matrix \(R\), we transform \(P\) so that $$P R = G.$$</p><h5>How do we find R?</h5>We can transform the equation above to $$R = (P^T P)^{-1} P^T G.$$ Now we have the matrix that scales and rotates the points obtained by MDS so that they match the geo-coordinates as closely as possible. To <strong>move</strong> the points to the right place, we simply calculate the centroid of the geo-coordinates and add it to each point in our set. The resulting points are depicted in the right map above.<h3>Notes</h3><ul><li><strong>Transit vs. Driving:</strong> By a small modification of the <a href="https://github.com/theblog/theblog.github.io/blob/master/src/js/posts/visualizing-travel-times-with-multidimensional-scaling/maps.js">JavaScript code</a>, you can also calculate the driving durations. I tried it out and the resulting map did only differ slightly from the real map. So, driving durations seem to be quite proportional to distances between cities.</li><li><strong>Euclidean space:</strong> When using MDS, we map the matrix of travel times to a set of two-dimensional points. This is incorrect, as we should rather map them onto a sphere so that their great-circle distance is minimized. But as long as we are not dealing with polar trains, the introduced imprecision should be negligible.</li><li><strong>Credits:</strong> to <a href="http://www.benfrederickson.com/multidimensional-scaling/" target="_blank">Ben Frederickson</a> for providing insights and the JavaScript code used for Multidimensional Scaling.</li></ul></div><h3>Like what you read?</h3><div><div><applause-button url="https://theblog.github.io/visualizing-travel-times" multiclap="true" color="rgb(10, 18, 79)"></applause-button></div><p>I don't use Google Analytics or Disqus because they require cookies. I would still like to know, which posts are popular, so if you liked this post you can let me know here.</p></div></div></div></div></div></div></section><footer class="footer">Powered by <a href="https://github.com/jekyll/jekyll" target="_blank">Jekyll</a>.<br><a href="https://www.iubenda.com/privacy-policy/63560500/legal" class="no-highlight">Imprint and Privacy Policy</a></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.1.6/js/ion.rangeSlider.min.js"></script><script src="/js/lib/polyfill.min.js"></script><script src="/js/lib/highlight.min.js"></script><script src="/js/general.js"></script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="https://unpkg.com/applause-button/dist/applause-button.js"></script><script src="/js/post.js"></script><script src="/js/post-util.js"></script><script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyC3XlurKkJzI_3Th-g5uF4gekxhboPOMtI"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.js"></script><script src="/js/posts/visualizing-travel-times-with-multidimensional-scaling/markerwithlabel.js"></script><script src="/js/posts/visualizing-travel-times-with-multidimensional-scaling/maps.js"></script></body></html>