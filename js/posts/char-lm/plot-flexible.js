"use strict";function exportChart(){console.log(chartExport)}function plot(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=$("#run-group-dropdown").find(".dropdown-toggle").val();getLogs(e).then(function(n){return plotLogs(n,e,t)})}function getLogs(t){var e=runGroupValues[t],n={};return Promise.all(e.map(function(e){return $.getJSON("/assets/posts/char-lm/data/"+t+"/"+e+"/model.trainstate.json").then(function(t){n[e]=PostUtil.getPreprocessedLog(t.log)})})).then(function(){return n})}function getEquidistantPoints(t,e){if(t.length<=e)return t;var n=t.reduce(function(t,e){return e.x<t.minX&&(t.minX=e.x),e.x>t.maxX&&(t.maxX=e.x),t},{minX:t[0].x,maxX:t[0].x}),i=n.minX,o=[],a=(n.maxX-i)/(e-1);return t.sort(function(t,e){return t.x-e.x}).forEach(function(t){t.x>=i+o.length*a-Math.pow(10,-8)&&o.push(t)}),o}function getData(t,e,n){var i=[];return PostUtil.replaceClosestKeys(t[n],t[e]).forEach(function(t,e){i.push({x:e,y:t})}),i}function resetSlider(t,e){var n=e-t>2?0:1,i=$("#y-axis-range").data("ionRangeSlider"),o=Math.pow(10,n);t=(Math.floor(t*o)/o).toFixed(n),e=(Math.ceil(e*o)/o).toFixed(n),i.update({min:t,max:e,from:t,to:e})}function plotLogs(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=$("#x-axis-dropdown").find(".dropdown-toggle").val(),o=$("#y-axis-dropdown").find(".dropdown-toggle").val(),a=Y_AXIS_RANGE_SLIDER.data("ionRangeSlider"),l={min:null,max:null},r=Object.keys(t).map(function(r,s){var _=getData(t[r],i,o);return _=_.filter(function(t){return!(t.y>30||t.y<.01)&&((null==l.min||t.y<l.min)&&(l.min=t.y),(null==l.max||t.y>l.max)&&(l.max=t.y),n||a.result.from<=t.y&&t.y<=a.result.to)}),_=getEquidistantPoints(_,30),{label:r,data:_,borderColor:RUN_GROUP_COLORS[e][r],backgroundColor:RUN_GROUP_COLORS[e][r]}});n&&resetSlider(l.min,l.max),PostUtil.clearChart("flexible-chart");var s={type:"line",data:{datasets:r},options:{scales:{xAxes:[{type:"linear",position:"bottom",scaleLabel:{display:!0,labelString:AXIS_LABELS[i]}}],yAxes:[{type:"logarithmic",ticks:{min:n?l.min:a.result.from,max:n?l.max:a.result.to,callback:function(t){return t.toFixed(2)}},scaleLabel:{display:!0,labelString:AXIS_LABELS[o]}}]}}};chartExport=JSON.stringify(s),new Chart("flexible-chart",s)}var runGroupValues={batch_size:["1","10","20","50","100","200","500","2000"],learning_rate_512:["0.05","0.01","0.005","0.001"],num_timesteps:["40","80","120","160"],learning_rate_1024:["0.01","0.005","0.001"],num_neurons:["512","1024"],output_keep_prob:["0.3","0.5","0.8"],num_layers:["2","3","4"],reset_state_interval_tokens:["never","always","320","1120","2080"],wiki:["small","medium","medium-with-reset"]},RUN_GROUP_COLORS={batch_size:{1:"#FFCDD2",10:"#E57373",20:"#C8E6C9",50:"#66BB6A",100:"#2E7D32",200:"#123317",500:"#FFECB3",2e3:"#FFC107"},learning_rate_512:{.05:PostUtil.CHART_COLORS_BLUE[0],.01:PostUtil.CHART_COLORS_BLUE[1],.005:PostUtil.CHART_COLORS_BLUE[3],.001:PostUtil.CHART_COLORS_BLUE[4]},num_timesteps:{40:PostUtil.CHART_COLORS_BLUE[0],80:PostUtil.CHART_COLORS_BLUE[1],120:PostUtil.CHART_COLORS_BLUE[3],160:PostUtil.CHART_COLORS_BLUE[4]},learning_rate_1024:{.01:PostUtil.CHART_COLORS_BLUE[0],.005:PostUtil.CHART_COLORS_BLUE[2],.001:PostUtil.CHART_COLORS_BLUE[4]},num_neurons:{512:PostUtil.CHART_COLORS_BLUE[1],1024:PostUtil.CHART_COLORS_BLUE[4]},output_keep_prob:{.3:PostUtil.CHART_COLORS_BLUE[0],.5:PostUtil.CHART_COLORS_BLUE[2],.8:PostUtil.CHART_COLORS_BLUE[4]},num_layers:{2:PostUtil.CHART_COLORS_BLUE[0],3:PostUtil.CHART_COLORS_BLUE[2],4:PostUtil.CHART_COLORS_BLUE[4]},reset_state_interval_tokens:{always:PostUtil.CHART_COLORS_BLUE[0],320:PostUtil.CHART_COLORS_BLUE[1],1120:PostUtil.CHART_COLORS_BLUE[2],2080:PostUtil.CHART_COLORS_BLUE[3],never:PostUtil.CHART_COLORS_BLUE[4]}},AXIS_LABELS={lossesValid:"Validation Perplexity",lossesTrain:"Training Perplexity",minutesSinceStart:"Training Time [min]",epochs:"Epoch"},Y_AXIS_RANGE_SLIDER=$("#y-axis-range"),chartExport=null;$(function(){Chart.defaults.global.maintainAspectRatio=!1,Chart.defaults.global.elements.line.fill=!1,Chart.defaults.global.elements.line.tension=0,Chart.defaults.global.elements.point.radius=0,Y_AXIS_RANGE_SLIDER=$("#y-axis-range"),chartExport=null,Y_AXIS_RANGE_SLIDER.ionRangeSlider({type:"double",min:2,max:24,onFinish:function(){return plot()}})});